

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>imgutils.sd.metadata &mdash; imgutils 0.9.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=c9d0a6ec" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=1bc1ca25"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="imgutils.sd.model" href="model.html" />
    <link rel="prev" title="imgutils.sd" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            imgutils
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quick_start/index.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../information/environment.result.html">Run Environment Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">imgutils.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ascii/index.html">imgutils.ascii</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">imgutils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detect/index.html">imgutils.detect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../edge/index.html">imgutils.edge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generic/index.html">imgutils.generic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata/index.html">imgutils.metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">imgutils.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ocr/index.html">imgutils.ocr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operate/index.html">imgutils.operate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pose/index.html">imgutils.pose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocess/index.html">imgutils.preprocess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource/index.html">imgutils.resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../restore/index.html">imgutils.restore</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">imgutils.sd</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">imgutils.sd.metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sdmetadata">SDMetaData</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imgutils.sd.metadata.SDMetaData"><code class="docutils literal notranslate"><span class="pre">SDMetaData</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#parse-sdmeta-from-text">parse_sdmeta_from_text</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imgutils.sd.metadata.parse_sdmeta_from_text"><code class="docutils literal notranslate"><span class="pre">parse_sdmeta_from_text()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#get-sdmeta-from-image">get_sdmeta_from_image</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imgutils.sd.metadata.get_sdmeta_from_image"><code class="docutils literal notranslate"><span class="pre">get_sdmeta_from_image()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#save-image-with-sdmeta">save_image_with_sdmeta</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imgutils.sd.metadata.save_image_with_sdmeta"><code class="docutils literal notranslate"><span class="pre">save_image_with_sdmeta()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="model.html">imgutils.sd.model</a></li>
<li class="toctree-l2"><a class="reference internal" href="nai.html">imgutils.sd.nai</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../segment/index.html">imgutils.segment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tagging/index.html">imgutils.tagging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upscale/index.html">imgutils.upscale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">imgutils.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validate/index.html">imgutils.validate</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">imgutils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">imgutils.sd</a></li>
      <li class="breadcrumb-item active">imgutils.sd.metadata</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api_doc/sd/metadata.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
    
    
  <section id="module-imgutils.sd.metadata">
<span id="imgutils-sd-metadata"></span><h1>imgutils.sd.metadata<a class="headerlink" href="#module-imgutils.sd.metadata" title="Permalink to this heading"></a></h1>
<dl>
<dt>Overview:</dt><dd><p>Metadata parser and formatter for a1111’s webui generated images.</p>
<p>Here are 2 sample images: <a class="reference download internal" download="" href="../../_downloads/d1acc9bfb297591c1047242d801bfcbd/sd_metadata_simple.png"><code class="xref download docutils literal notranslate"><span class="pre">sd_metadata_simple.png</span></code></a>
and <a class="reference download internal" download="" href="../../_downloads/2799bdff74fab5a61e0c4ed408f03484/sd_metadata_complex.png"><code class="xref download docutils literal notranslate"><span class="pre">sd_metadata_complex.png</span></code></a>.</p>
</dd>
</dl>
<section id="sdmetadata">
<h2>SDMetaData<a class="headerlink" href="#sdmetadata" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="imgutils.sd.metadata.SDMetaData">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">imgutils.sd.metadata.</span></span><span class="sig-name descname"><span class="pre">SDMetaData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neg_prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/imgutils/sd/metadata.html#SDMetaData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.sd.metadata.SDMetaData" title="Permalink to this definition"></a></dt>
<dd><p>Store information parsed from the metadata of a PNG image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prompt</strong> (<em>str</em>) – The main prompt text.</p></li>
<li><p><strong>neg_prompt</strong> (<em>str</em>) – The negative prompt text.</p></li>
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – A dictionary containing various parameters.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="imgutils.sd.metadata.SDMetaData.__str__">
<span class="sig-name descname"><span class="pre">__str__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/imgutils/sd/metadata.html#SDMetaData.__str__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.sd.metadata.SDMetaData.__str__" title="Permalink to this definition"></a></dt>
<dd><p>Get a string representation of the metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A string representation of the metadata.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
<dl>
<dt>Examples::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.sd</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sdmeta_from_image</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd1</span> <span class="o">=</span> <span class="n">get_sdmeta_from_image</span><span class="p">(</span><span class="s1">&#39;sd_metadata_simple.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">sd1</span><span class="p">)</span>
<span class="go">(extremely delicate and beautiful), best quality, official art, global illumination, soft shadow, super detailed, Japanese light novel cover, 4K, metal_texture, (striped_background), super detailed background, more detailed, rich detailed, extremely detailed CG unity 8k wallpaper, ((unreal)), sci-fi,(fantasy),(masterpiece),(super delicate), (illustration), (extremely delicate and beautiful), anime coloring,</span>
<span class="go">(silver_skin), ((high-cut silver_impossible_bodysuit), ((gem_on_chest)),(high-cut_silver_mechanical_leotard)),headgear,</span>
<span class="go">(focus-on:1.1),(1_girl),((solo)),slim_waist,white hair, long hair, luminous yellow eyes,(medium_breast:1.2), (Indistinct_cameltoe:0.9), (flat_crotch:1.1),(coquettish), (squint:1.4),(evil_smile :1.35),(dark_persona), [open mouth: 0.7], standing,[wet:0.7],</span>
<span class="go">slim_face, tall_girl,(mature),mature_face, (slim_figure), (slim_legs:1.1), (groin:1.1), ((bare_thighs)),</span>
<span class="go">Negative prompt: EasyNegative, sketch, duplicate, ugly, huge eyes, text, logo, monochrome, worst face, (bad and mutated hands:1.3), (worst quality:2.0), (low quality:2.0), (blurry:2.0), horror, geometry, bad_prompt, (bad hands), (missing fingers), multiple limbs, bad anatomy, (interlocked fingers:1.2), Ugly Fingers, (extra digit and hands and fingers and legs and arms:1.4), ((2girl)), (deformed fingers:1.2), (long fingers:1.2),(bad-artist-anime), bad-artist, bad hand, blush, (lipstick),skindentation, tie, ((big_breast)), (nipple), thighhighs, pubic_hair, pussy, black and white,(3d), ((realistic)),blurry,nipple slip, (nipple), blush, head_out_of_frame,curvy,</span>
<span class="go">Steps: 20, Sampler: DDIM, CFG scale: 7, Seed: 3827064803, Size: 512x848, Model hash: eb49192009, Model: AniDosMix, Clip skip: 2</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="imgutils.sd.metadata.SDMetaData.pnginfo">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pnginfo</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">PngInfo</span></em><a class="headerlink" href="#imgutils.sd.metadata.SDMetaData.pnginfo" title="Permalink to this definition"></a></dt>
<dd><p>Generate a PngInfo object with the metadata.</p>
<p>This can be used when saving an image with custom metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A PngInfo object containing the metadata.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>PngInfo</p>
</dd>
</dl>
<dl>
<dt>Examples::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.sd</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sdmeta_from_image</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># get metadata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd1</span> <span class="o">=</span> <span class="n">get_sdmeta_from_image</span><span class="p">(</span><span class="s1">&#39;sd_metadata_simple.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># create an image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># save this image with sd1&#39;s metadata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;new_image.png&#39;</span><span class="p">,</span> <span class="n">pnginfo</span><span class="o">=</span><span class="n">sd1</span><span class="o">.</span><span class="n">pnginfo</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># let&#39;s see what is in &#39;new_image.png&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_sdmeta_from_image</span><span class="p">(</span><span class="s1">&#39;new_image.png&#39;</span><span class="p">)</span>
<span class="go">SDMetaData(prompt=&#39;(extremely delicate and beautiful), best quality, official art, global illumination, soft shadow, super detailed, Japanese light novel cover, 4K, metal_texture, (striped_background), super detailed background, more detailed, rich detailed, extremely detailed CG unity 8k wallpaper, ((unreal)), sci-fi,(fantasy),(masterpiece),(super delicate), (illustration), (extremely delicate and beautiful), anime coloring,\n(silver_skin), ((high-cut silver_impossible_bodysuit), ((gem_on_chest)),(high-cut_silver_mechanical_leotard)),headgear,\n(focus-on:1.1),(1_girl),((solo)),slim_waist,white hair, long hair, luminous yellow eyes,(medium_breast:1.2), (Indistinct_cameltoe:0.9), (flat_crotch:1.1),(coquettish), (squint:1.4),(evil_smile :1.35),(dark_persona), [open mouth: 0.7], standing,[wet:0.7],\nslim_face, tall_girl,(mature),mature_face, (slim_figure), (slim_legs:1.1), (groin:1.1), ((bare_thighs)),&#39;, neg_prompt=&#39;EasyNegative, sketch, duplicate, ugly, huge eyes, text, logo, monochrome, worst face, (bad and mutated hands:1.3), (worst quality:2.0), (low quality:2.0), (blurry:2.0), horror, geometry, bad_prompt, (bad hands), (missing fingers), multiple limbs, bad anatomy, (interlocked fingers:1.2), Ugly Fingers, (extra digit and hands and fingers and legs and arms:1.4), ((2girl)), (deformed fingers:1.2), (long fingers:1.2),(bad-artist-anime), bad-artist, bad hand, blush, (lipstick),skindentation, tie, ((big_breast)), (nipple), thighhighs, pubic_hair, pussy, black and white,(3d), ((realistic)),blurry,nipple slip, (nipple), blush, head_out_of_frame,curvy,&#39;, parameters={&#39;Steps&#39;: 20, &#39;Sampler&#39;: &#39;DDIM&#39;, &#39;CFG scale&#39;: 7, &#39;Seed&#39;: 3827064803, &#39;Size&#39;: (512, 848), &#39;Model hash&#39;: &#39;eb49192009&#39;, &#39;Model&#39;: &#39;AniDosMix&#39;, &#39;Clip skip&#39;: 2})</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="imgutils.sd.metadata.SDMetaData.text">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">text</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#imgutils.sd.metadata.SDMetaData.text" title="Permalink to this definition"></a></dt>
<dd><p>Get the metadata as a formatted string.</p>
<p>This property provides a convenient way to access the string representation
of the metadata without calling _sdmeta_text() directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A formatted string containing the metadata.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
<dl>
<dt>Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">SDMetaData</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;A starry night&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">neg_prompt</span><span class="o">=</span><span class="s2">&quot;Daylight&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Steps&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;Sampler&quot;</span><span class="p">:</span> <span class="s2">&quot;Euler&quot;</span><span class="p">,</span> <span class="s2">&quot;CFG scale&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="go">A starry night</span>
<span class="go">Negative prompt: Daylight</span>
<span class="go">Steps: 40, Sampler: Euler, CFG scale: 8</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="parse-sdmeta-from-text">
<h2>parse_sdmeta_from_text<a class="headerlink" href="#parse-sdmeta-from-text" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="imgutils.sd.metadata.parse_sdmeta_from_text">
<span class="sig-prename descclassname"><span class="pre">imgutils.sd.metadata.</span></span><span class="sig-name descname"><span class="pre">parse_sdmeta_from_text</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#imgutils.sd.metadata.SDMetaData" title="imgutils.sd.metadata.SDMetaData"><span class="pre">SDMetaData</span></a></span></span><a class="reference internal" href="../../_modules/imgutils/sd/metadata.html#parse_sdmeta_from_text"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.sd.metadata.parse_sdmeta_from_text" title="Permalink to this definition"></a></dt>
<dd><p>Parse metadata information from a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>str</em>) – The input string containing metadata.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A SDMetaData object containing the parsed metadata.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#imgutils.sd.metadata.SDMetaData" title="imgutils.sd.metadata.SDMetaData">SDMetaData</a></p>
</dd>
</dl>
<dl>
<dt>Examples::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.sd</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_sdmeta_from_text</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd1</span> <span class="o">=</span> <span class="n">parse_sdmeta_from_text</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">(extremely delicate and beautiful), best quality, official art, global illumination, soft shadow, super detailed, Japanese light novel cover, 4K, metal_texture, (striped_background), super detailed background, more detailed, rich detailed, extremely detailed CG unity 8k wallpaper, ((unreal)), sci-fi,(fantasy),(masterpiece),(super delicate), (illustration), (extremely delicate and beautiful), anime coloring,</span>
<span class="gp">... </span><span class="s2">(silver_skin), ((high-cut silver_impossible_bodysuit), ((gem_on_chest)),(high-cut_silver_mechanical_leotard)),headgear,</span>
<span class="gp">... </span><span class="s2">(focus-on:1.1),(1_girl),((solo)),slim_waist,white hair, long hair, luminous yellow eyes,(medium_breast:1.2), (Indistinct_cameltoe:0.9), (flat_crotch:1.1),(coquettish), (squint:1.4),(evil_smile :1.35),(dark_persona), [open mouth: 0.7], standing,[wet:0.7],</span>
<span class="gp">... </span><span class="s2">slim_face, tall_girl,(mature),mature_face, (slim_figure), (slim_legs:1.1), (groin:1.1), ((bare_thighs)),</span>
<span class="gp">... </span><span class="s2">Negative prompt: EasyNegative, sketch, duplicate, ugly, huge eyes, text, logo, monochrome, worst face, (bad and mutated hands:1.3), (worst quality:2.0), (low quality:2.0), (blurry:2.0), horror, geometry, bad_prompt, (bad hands), (missing fingers), multiple limbs, bad anatomy, (interlocked fingers:1.2), Ugly Fingers, (extra digit and hands and fingers and legs and arms:1.4), ((2girl)), (deformed fingers:1.2), (long fingers:1.2),(bad-artist-anime), bad-artist, bad hand, blush, (lipstick),skindentation, tie, ((big_breast)), (nipple), thighhighs, pubic_hair, pussy, black and white,(3d), ((realistic)),blurry,nipple slip, (nipple), blush, head_out_of_frame,curvy,</span>
<span class="gp">... </span><span class="s2">Steps: 20, Sampler: DDIM, CFG scale: 7, Seed: 3827064803, Size: 512x848, Model hash: eb49192009, Model: AniDosMix, Clip skip: 2</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd1</span>
<span class="go">SDMetaData(prompt=&#39;(extremely delicate and beautiful), best quality, official art, global illumination, soft shadow, super detailed, Japanese light novel cover, 4K, metal_texture, (striped_background), super detailed background, more detailed, rich detailed, extremely detailed CG unity 8k wallpaper, ((unreal)), sci-fi,(fantasy),(masterpiece),(super delicate), (illustration), (extremely delicate and beautiful), anime coloring,\n(silver_skin), ((high-cut silver_impossible_bodysuit), ((gem_on_chest)),(high-cut_silver_mechanical_leotard)),headgear,\n(focus-on:1.1),(1_girl),((solo)),slim_waist,white hair, long hair, luminous yellow eyes,(medium_breast:1.2), (Indistinct_cameltoe:0.9), (flat_crotch:1.1),(coquettish), (squint:1.4),(evil_smile :1.35),(dark_persona), [open mouth: 0.7], standing,[wet:0.7],\nslim_face, tall_girl,(mature),mature_face, (slim_figure), (slim_legs:1.1), (groin:1.1), ((bare_thighs)),&#39;, neg_prompt=&#39;EasyNegative, sketch, duplicate, ugly, huge eyes, text, logo, monochrome, worst face, (bad and mutated hands:1.3), (worst quality:2.0), (low quality:2.0), (blurry:2.0), horror, geometry, bad_prompt, (bad hands), (missing fingers), multiple limbs, bad anatomy, (interlocked fingers:1.2), Ugly Fingers, (extra digit and hands and fingers and legs and arms:1.4), ((2girl)), (deformed fingers:1.2), (long fingers:1.2),(bad-artist-anime), bad-artist, bad hand, blush, (lipstick),skindentation, tie, ((big_breast)), (nipple), thighhighs, pubic_hair, pussy, black and white,(3d), ((realistic)),blurry,nipple slip, (nipple), blush, head_out_of_frame,curvy,&#39;, parameters={&#39;Steps&#39;: 20, &#39;Sampler&#39;: &#39;DDIM&#39;, &#39;CFG scale&#39;: 7, &#39;Seed&#39;: 3827064803, &#39;Size&#39;: (512, 848), &#39;Model hash&#39;: &#39;eb49192009&#39;, &#39;Model&#39;: &#39;AniDosMix&#39;, &#39;Clip skip&#39;: 2})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">sd1</span><span class="p">)</span>
<span class="go">&lt;class &#39;imgutils.sd.metadata.SDMetaData&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd2</span> <span class="o">=</span> <span class="n">parse_sdmeta_from_text</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s2">1girl, solo, blue eyes, black footwear, white hair, looking at viewer, shoes, full body, standing, bangs, indoors, wide sleeves, ahoge, dress, closed mouth, blush, long sleeves, potted plant, bag, plant, hair bun, window,&lt;lora:BlueArchive10:1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1&gt;,BlueArchive,</span>
<span class="gp">... </span><span class="s2">Negative prompt: Neg1,Negative,</span>
<span class="gp">... </span><span class="s2">Steps: 20, Sampler: DPM++ 2M SDE Karras, CFG scale: 7, Seed: 2647703743, Size: 768x768, Model hash: 72bd94132e, Model: CuteMix, Denoising strength: 0.7, ControlNet 0: &quot;preprocessor: openpose, model: control_v11p_sd15_openpose [cab727d4], weight: 1, starting/ending: (0, 1), resize mode: Crop and Resize, pixel perfect: False, control mode: Balanced, preprocessor params: (512, 64, 64)&quot;, Hires upscale: 2, Hires upscaler: Latent, TI hashes: &quot;Neg1: 339cc9210f70, Negative: 66a7279a88dd&quot;, Version: v1.5.1</span>
<span class="gp">... </span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd2</span>
<span class="go">SDMetaData(prompt=&#39;1girl, solo, blue eyes, black footwear, white hair, looking at viewer, shoes, full body, standing, bangs, indoors, wide sleeves, ahoge, dress, closed mouth, blush, long sleeves, potted plant, bag, plant, hair bun, window,&lt;lora:BlueArchive10:1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1&gt;,BlueArchive,&#39;, neg_prompt=&#39;Neg1,Negative,&#39;, parameters={&#39;Steps&#39;: 20, &#39;Sampler&#39;: &#39;DPM++ 2M SDE Karras&#39;, &#39;CFG scale&#39;: 7, &#39;Seed&#39;: 2647703743, &#39;Size&#39;: (768, 768), &#39;Model hash&#39;: &#39;72bd94132e&#39;, &#39;Model&#39;: &#39;CuteMix&#39;, &#39;Denoising strength&#39;: 0.7, &#39;ControlNet 0&#39;: &#39;preprocessor: openpose, model: control_v11p_sd15_openpose [cab727d4], weight: 1, starting/ending: (0, 1), resize mode: Crop and Resize, pixel perfect: False, control mode: Balanced, preprocessor params: (512, 64, 64)&#39;, &#39;Hires upscale&#39;: 2, &#39;Hires upscaler&#39;: &#39;Latent&#39;, &#39;TI hashes&#39;: &#39;Neg1: 339cc9210f70, Negative: 66a7279a88dd&#39;, &#39;Version&#39;: &#39;v1.5.1&#39;})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">sd2</span><span class="p">)</span>
<span class="go">&lt;class &#39;imgutils.sd.metadata.SDMetaData&#39;&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
<section id="get-sdmeta-from-image">
<h2>get_sdmeta_from_image<a class="headerlink" href="#get-sdmeta-from-image" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="imgutils.sd.metadata.get_sdmeta_from_image">
<span class="sig-prename descclassname"><span class="pre">imgutils.sd.metadata.</span></span><span class="sig-name descname"><span class="pre">get_sdmeta_from_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytearray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BinaryIO</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Image</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#imgutils.sd.metadata.SDMetaData" title="imgutils.sd.metadata.SDMetaData"><span class="pre">SDMetaData</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="reference internal" href="../../_modules/imgutils/sd/metadata.html#get_sdmeta_from_image"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.sd.metadata.get_sdmeta_from_image" title="Permalink to this definition"></a></dt>
<dd><p>Extract and parse Stable Diffusion metadata from an image.</p>
<p>This function attempts to read SD metadata from various sources within the image,
including PNG info, EXIF data, and GIF metadata. If found, it parses the metadata
into an SDMetaData object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>image</strong> (<em>ImageTyping</em>) – The input image, which can be a file path, URL, or PIL Image object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An SDMetaData object containing the parsed metadata if available, else None.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[<a class="reference internal" href="#imgutils.sd.metadata.SDMetaData" title="imgutils.sd.metadata.SDMetaData">SDMetaData</a>]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p>Various exceptions may be raised by the underlying image loading and
metadata reading functions.</p>
</dd>
</dl>
<dl>
<dt>Example usage:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.sd</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sdmeta_from_image</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd_meta</span> <span class="o">=</span> <span class="n">get_sdmeta_from_image</span><span class="p">(</span><span class="s1">&#39;path/to/image.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">sd_meta</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prompt: </span><span class="si">{</span><span class="n">sd_meta</span><span class="o">.</span><span class="n">prompt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Negative prompt: </span><span class="si">{</span><span class="n">sd_meta</span><span class="o">.</span><span class="n">neg_prompt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters: </span><span class="si">{</span><span class="n">sd_meta</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No SD metadata found in the image.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>Note: This function depends on the load_image and parse_sdmeta_from_text functions.
Ensure these are properly imported or defined in the current scope.</p>
</dd></dl>

</section>
<section id="save-image-with-sdmeta">
<h2>save_image_with_sdmeta<a class="headerlink" href="#save-image-with-sdmeta" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="imgutils.sd.metadata.save_image_with_sdmeta">
<span class="sig-prename descclassname"><span class="pre">imgutils.sd.metadata.</span></span><span class="sig-name descname"><span class="pre">save_image_with_sdmeta</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytearray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BinaryIO</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metadata</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#imgutils.sd.metadata.SDMetaData" title="imgutils.sd.metadata.SDMetaData"><span class="pre">SDMetaData</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/imgutils/sd/metadata.html#save_image_with_sdmeta"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.sd.metadata.save_image_with_sdmeta" title="Permalink to this definition"></a></dt>
<dd><p>Save an image with Stable Diffusion metadata.</p>
<p>This function saves the given image to the specified destination file, including
the provided SD metadata. The metadata is saved in a format appropriate for the
output image type (PNG, JPEG, WebP, or GIF).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>ImageTyping</em>) – The input image, which can be a file path, URL, or PIL Image object.</p></li>
<li><p><strong>dst_file</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>os.PathLike</em><em>]</em>) – The destination file path where the image will be saved.</p></li>
<li><p><strong>metadata</strong> (<a class="reference internal" href="#imgutils.sd.metadata.SDMetaData" title="imgutils.sd.metadata.SDMetaData"><em>SDMetaData</em></a>) – The SD metadata to include with the image.</p></li>
<li><p><strong>kwargs</strong> – Additional keyword arguments to pass to the underlying save function.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>SystemError</strong> – If the output file type is not supported for saving with metadata.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p>Various exceptions may be raised by the underlying image loading and
saving functions.</p>
</dd>
</dl>
<dl>
<dt>Example usage:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.sd</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_sdmeta_from_image</span><span class="p">,</span> <span class="n">save_image_with_sdmeta</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_image</span> <span class="o">=</span> <span class="s1">&#39;path/to/input.png&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">output_image</span> <span class="o">=</span> <span class="s1">&#39;path/to/output.png&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sd_meta</span> <span class="o">=</span> <span class="n">get_sdmeta_from_image</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">sd_meta</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">save_image_with_sdmeta</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">output_image</span><span class="p">,</span> <span class="n">sd_meta</span><span class="p">)</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image saved with SD metadata to </span><span class="si">{</span><span class="n">output_image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No SD metadata found in the input image.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="imgutils.sd" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model.html" class="btn btn-neutral float-right" title="imgutils.sd.model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, narugo1992, 7eu7d7.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.9.0
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../v0.5.0/api_doc/sd/metadata.html">v0.5.0</a></dd>
                        <dd><a href="../../../v0.6.0/api_doc/sd/metadata.html">v0.6.0</a></dd>
                        <dd><a href="../../../v0.6.1/api_doc/sd/metadata.html">v0.6.1</a></dd>
                        <dd><a href="../../../v0.6.2/api_doc/sd/metadata.html">v0.6.2</a></dd>
                        <dd><a href="../../../v0.6.3/api_doc/sd/metadata.html">v0.6.3</a></dd>
                        <dd><a href="../../../v0.7.0/api_doc/sd/metadata.html">v0.7.0</a></dd>
                        <dd><a href="../../../v0.7.1/api_doc/sd/metadata.html">v0.7.1</a></dd>
                        <dd><a href="../../../v0.8.0/api_doc/sd/metadata.html">v0.8.0</a></dd>
                        <dd><a href="metadata.html">v0.9.0</a></dd>
                        <dd><a href="../../../v0.9.1/api_doc/sd/metadata.html">v0.9.1</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="../../../dev/transformers/api_doc/sd/metadata.html">dev/transformers</a></dd>
                        <dd><a href="../../../HEAD/api_doc/sd/metadata.html">HEAD</a></dd>
                        <dd><a href="../../../dev/denormalize/api_doc/sd/metadata.html">dev/denormalize</a></dd>
                        <dd><a href="../../../main/api_doc/sd/metadata.html">main</a></dd>
                </dl>
        </div>
    </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>