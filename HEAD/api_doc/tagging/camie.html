

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>imgutils.tagging.camie &mdash; imgutils 0.18.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=c9d0a6ec" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=66734c64"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="imgutils.tagging.deepdanbooru" href="deepdanbooru.html" />
    <link rel="prev" title="imgutils.tagging.wd14" href="wd14.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            imgutils
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/quick_start/index.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../information/environment.result.html">Run Environment Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../config/index.html">imgutils.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ascii/index.html">imgutils.ascii</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">imgutils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../detect/index.html">imgutils.detect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../edge/index.html">imgutils.edge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generic/index.html">imgutils.generic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata/index.html">imgutils.metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metrics/index.html">imgutils.metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ocr/index.html">imgutils.ocr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operate/index.html">imgutils.operate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pose/index.html">imgutils.pose</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocess/index.html">imgutils.preprocess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource/index.html">imgutils.resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="../restore/index.html">imgutils.restore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sd/index.html">imgutils.sd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../segment/index.html">imgutils.segment</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">imgutils.tagging</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mldanbooru.html">imgutils.tagging.mldanbooru</a></li>
<li class="toctree-l2"><a class="reference internal" href="wd14.html">imgutils.tagging.wd14</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">imgutils.tagging.camie</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-camie-tags">get_camie_tags</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imgutils.tagging.camie.get_camie_tags"><code class="docutils literal notranslate"><span class="pre">get_camie_tags()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#convert-camie-emb-to-prediction">convert_camie_emb_to_prediction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imgutils.tagging.camie.convert_camie_emb_to_prediction"><code class="docutils literal notranslate"><span class="pre">convert_camie_emb_to_prediction()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deepdanbooru.html">imgutils.tagging.deepdanbooru</a></li>
<li class="toctree-l2"><a class="reference internal" href="deepgelbooru.html">imgutils.tagging.deepgelbooru</a></li>
<li class="toctree-l2"><a class="reference internal" href="format.html">imgutils.tagging.format</a></li>
<li class="toctree-l2"><a class="reference internal" href="overlap.html">imgutils.tagging.overlap</a></li>
<li class="toctree-l2"><a class="reference internal" href="blacklist.html">imgutils.tagging.blacklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="character.html">imgutils.tagging.character</a></li>
<li class="toctree-l2"><a class="reference internal" href="order.html">imgutils.tagging.order</a></li>
<li class="toctree-l2"><a class="reference internal" href="match.html">imgutils.tagging.match</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../upscale/index.html">imgutils.upscale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">imgutils.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validate/index.html">imgutils.validate</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">imgutils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">imgutils.tagging</a></li>
      <li class="breadcrumb-item active">imgutils.tagging.camie</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/api_doc/tagging/camie.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
    
    
  <section id="module-imgutils.tagging.camie">
<span id="imgutils-tagging-camie"></span><h1>imgutils.tagging.camie<a class="headerlink" href="#module-imgutils.tagging.camie" title="Permalink to this heading"></a></h1>
<dl class="simple">
<dt>Overview:</dt><dd><p>This module provides functionality for image tagging using the Camie Tagger model,
which can identify over 70,000 tags in images.
The implementation is based on the <a class="reference external" href="https://huggingface.co/Camais03/camie-tagger">Camais03/camie-tagger</a> project,
with ONNX optimizations available at <a class="reference external" href="https://huggingface.co/deepghs/camie_tagger_onnx">deepghs/camie_tagger_onnx</a>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The tagger categorizes tags into multiple types including rating, general, characters, year, meta, artist,
and copyright. While rating, general, and character tags tend to be accurate, other tag types
(year, meta, artist, copyright) have shown limited accuracy in testing and are not included in default outputs.</p>
</div>
<section id="get-camie-tags">
<h2>get_camie_tags<a class="headerlink" href="#get-camie-tags" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="imgutils.tagging.camie.get_camie_tags">
<span class="sig-prename descclassname"><span class="pre">imgutils.tagging.camie.</span></span><span class="sig-name descname"><span class="pre">get_camie_tags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytes</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">bytearray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">BinaryIO</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'initial'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'balanced'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'high_precision'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'high_recall'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'micro_opt'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'macro_opt'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'balanced'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresholds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_underline</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_overlap</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('rating',</span> <span class="pre">'general',</span> <span class="pre">'character')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/imgutils/tagging/camie.html#get_camie_tags"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.tagging.camie.get_camie_tags" title="Permalink to this definition"></a></dt>
<dd><p>Extract tags from an image using the Camie model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>ImageTyping</em>) – Input image (can be path, URL, or image data).</p></li>
<li><p><strong>model_name</strong> (<em>str</em>) – Name of the Camie model to use.</p></li>
<li><p><strong>mode</strong> (<em>CamieModeTyping</em>) – Prediction mode affecting threshold values.</p></li>
<li><p><strong>thresholds</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>float</em><em>, </em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>float</em><em>]</em><em>]</em><em>]</em>) – Custom thresholds for tag selection.</p></li>
<li><p><strong>no_underline</strong> (<em>bool</em>) – Whether to remove underscores from tag names. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>drop_overlap</strong> (<em>bool</em>) – Whether to remove overlapping tags. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>fmt</strong> (<em>Any</em>) – Format specification for output. Default is <code class="docutils literal notranslate"><span class="pre">('rating',</span> <span class="pre">'general',</span> <span class="pre">'character')</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Extracted tags and embeddings, follow the format from <code class="docutils literal notranslate"><span class="pre">fmt</span></code>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Modes for selection:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">balanced</span></code>: Balanced precision/recall</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">high_precision</span></code>: Higher precision thresholds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">high_recall</span></code>: Higher recall thresholds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">micro_opt</span></code>: Micro-optimized thresholds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">macro_opt</span></code>: Macro-optimized thresholds</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The fmt argument can include the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rating</span></code>: a dict containing ratings and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">general</span></code>: a dict containing general tags and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">character</span></code>: a dict containing character tags and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">copyright</span></code>: a dict containing copyright tags and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">artist</span></code>: a dict containing artist tags and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meta</span></code>: a dict containing meta tags and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">year</span></code>: a dict containing year tags and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tag</span></code>: a dict containing all tags (including general, character, copyright, artist, meta, year, not including rating) and their confidences</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">embedding</span></code>: a 1-dim embedding of image, recommended for index building after L2 normalization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prediction</span></code>: a 1-dim prediction result of image</p></li>
</ul>
<p>You can extract embedding of the given image with the following code</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.tagging</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_camie_tags</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embedding</span> <span class="o">=</span> <span class="n">get_camie_tags</span><span class="p">(</span><span class="s1">&#39;skadi.jpg&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;embedding&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embedding</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1280, )</span>
</pre></div>
</div>
<p>This embedding is valuable for constructing indices that enable rapid querying of images based on
visual features within large-scale datasets.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>From our testings, other tag types (year, meta, artist, copyright) have shown limited accuracy.
Especially for artist tags, just a bit better than <code class="docutils literal notranslate"><span class="pre">np.random.randn</span></code>. So these tag types are
not included in default <code class="docutils literal notranslate"><span class="pre">fmt</span></code>.</p>
</div>
<dl>
<dt>Example:</dt><dd><p>Here are some images for example</p>
<img alt="../../_images/tagging_demo.plot.py.svg" class="align-center" src="../../_images/tagging_demo.plot.py.svg" /><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rating</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">get_camie_tags</span><span class="p">(</span><span class="s1">&#39;skadi.jpg&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rating</span>
<span class="go">{&#39;general&#39;: 0.04246556758880615, &#39;sensitive&#39;: 0.6936423778533936, &#39;questionable&#39;: 0.23721203207969666, &#39;explicit&#39;: 0.033293724060058594}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">features</span>
<span class="go">{&#39;1girl&#39;: 0.8412569165229797, &#39;blush&#39;: 0.38029077649116516, &#39;breasts&#39;: 0.618192195892334, &#39;cowboy_shot&#39;: 0.37446439266204834, &#39;large_breasts&#39;: 0.5698797702789307, &#39;long_hair&#39;: 0.7119565010070801, &#39;looking_at_viewer&#39;: 0.5252856612205505, &#39;shirt&#39;: 0.46417444944381714, &#39;solo&#39;: 0.5428758859634399, &#39;standing&#39;: 0.34731733798980713, &#39;tail&#39;: 0.3911612927913666, &#39;thigh_gap&#39;: 0.2932726740837097, &#39;thighs&#39;: 0.4544200003147125, &#39;very_long_hair&#39;: 0.44711941480636597, &#39;ass&#39;: 0.2854885458946228, &#39;outdoors&#39;: 0.6344638466835022, &#39;red_eyes&#39;: 0.611354410648346, &#39;day&#39;: 0.564970850944519, &#39;hair_between_eyes&#39;: 0.4444340467453003, &#39;holding&#39;: 0.35846662521362305, &#39;parted_lips&#39;: 0.3867686092853546, &#39;blue_sky&#39;: 0.3723931908607483, &#39;cloud&#39;: 0.31086698174476624, &#39;short_sleeves&#39;: 0.43279752135276794, &#39;sky&#39;: 0.3896197974681854, &#39;gloves&#39;: 0.6638736724853516, &#39;grey_hair&#39;: 0.5094802975654602, &#39;sweat&#39;: 0.4867050349712372, &#39;navel&#39;: 0.6593714952468872, &#39;crop_top&#39;: 0.5243107676506042, &#39;shorts&#39;: 0.4374789893627167, &#39;artist_name&#39;: 0.3754707872867584, &#39;midriff&#39;: 0.6238733530044556, &#39;ass_visible_through_thighs&#39;: 0.31088054180145264, &#39;gym_uniform&#39;: 0.37657681107521057, &#39;black_shirt&#39;: 0.3012588620185852, &#39;watermark&#39;: 0.5147127509117126, &#39;web_address&#39;: 0.6296812295913696, &#39;short_shorts&#39;: 0.29214906692504883, &#39;black_shorts&#39;: 0.37801358103752136, &#39;buruma&#39;: 0.536261260509491, &#39;bike_shorts&#39;: 0.35828399658203125, &#39;black_gloves&#39;: 0.4156728982925415, &#39;sportswear&#39;: 0.44427722692489624, &#39;baseball_bat&#39;: 0.2838006019592285, &#39;crop_top_overhang&#39;: 0.49192047119140625, &#39;stomach&#39;: 0.36012423038482666, &#39;black_buruma&#39;: 0.3422132134437561, &#39;official_alternate_costume&#39;: 0.2783987522125244, &#39;baseball&#39;: 0.38377970457077026, &#39;baseball_mitt&#39;: 0.32592540979385376, &#39;cropped_shirt&#39;: 0.35402947664260864, &#39;holding_baseball_bat&#39;: 0.2758416533470154, &#39;black_sports_bra&#39;: 0.3463800549507141, &#39;sports_bra&#39;: 0.28466159105300903, &#39;exercising&#39;: 0.2603980302810669, &#39;bike_jersey&#39;: 0.2661605477333069, &#39;patreon_username&#39;: 0.7087235450744629, &#39;patreon_logo&#39;: 0.560276210308075}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chars</span>
<span class="go">{&#39;skadi_(arknights)&#39;: 0.5921452641487122}</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rating</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">get_camie_tags</span><span class="p">(</span><span class="s1">&#39;hutao.jpg&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rating</span>
<span class="go">{&#39;general&#39;: 0.41121846437454224, &#39;sensitive&#39;: 0.4002530574798584, &#39;questionable&#39;: 0.03438958525657654, &#39;explicit&#39;: 0.04617959260940552}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">features</span>
<span class="go">{&#39;1girl&#39;: 0.8312125205993652, &#39;blush&#39;: 0.3996567726135254, &#39;cowboy_shot&#39;: 0.28660568594932556, &#39;long_hair&#39;: 0.7184156775474548, &#39;long_sleeves&#39;: 0.4706878066062927, &#39;looking_at_viewer&#39;: 0.5503140687942505, &#39;school_uniform&#39;: 0.365602970123291, &#39;shirt&#39;: 0.41183334589004517, &#39;sidelocks&#39;: 0.28638553619384766, &#39;smile&#39;: 0.3707748055458069, &#39;solo&#39;: 0.520854115486145, &#39;standing&#39;: 0.2960333526134491, &#39;tongue&#39;: 0.6556028127670288, &#39;tongue_out&#39;: 0.6966925859451294, &#39;very_long_hair&#39;: 0.5526134371757507, &#39;skirt&#39;: 0.6872812509536743, &#39;brown_hair&#39;: 0.5945607423782349, &#39;hair_ornament&#39;: 0.4464661478996277, &#39;hair_ribbon&#39;: 0.3646523952484131, &#39;outdoors&#39;: 0.37938451766967773, &#39;red_eyes&#39;: 0.5426545143127441, &#39;ribbon&#39;: 0.3027467727661133, &#39;bag&#39;: 0.8986430168151855, &#39;hair_between_eyes&#39;: 0.337802529335022, &#39;holding&#39;: 0.38589367270469666, &#39;pleated_skirt&#39;: 0.6475872993469238, &#39;school_bag&#39;: 0.666648805141449, &#39;ahoge&#39;: 0.4749193489551544, &#39;white_shirt&#39;: 0.27104783058166504, &#39;closed_mouth&#39;: 0.28101325035095215, &#39;collared_shirt&#39;: 0.37030768394470215, &#39;miniskirt&#39;: 0.32576680183410645, &#39;:p&#39;: 0.4337637424468994, &#39;alternate_costume&#39;: 0.42441293597221375, &#39;black_skirt&#39;: 0.34694597125053406, &#39;twintails&#39;: 0.5711237192153931, &#39;open_clothes&#39;: 0.31017544865608215, &#39;nail_polish&#39;: 0.534726083278656, &#39;jacket&#39;: 0.4544385075569153, &#39;open_jacket&#39;: 0.27831193804740906, &#39;flower&#39;: 0.45064714550971985, &#39;plaid_clothes&#39;: 0.5494365096092224, &#39;plaid_skirt&#39;: 0.610480546951294, &#39;red_flower&#39;: 0.35928308963775635, &#39;contemporary&#39;: 0.37732189893722534, &#39;backpack&#39;: 0.5575172305107117, &#39;fingernails&#39;: 0.27776333689689636, &#39;cardigan&#39;: 0.3264558017253876, &#39;blue_jacket&#39;: 0.31882336735725403, &#39;ghost&#39;: 0.5534622073173523, &#39;red_nails&#39;: 0.38771501183509827, &#39;:q&#39;: 0.3758758008480072, &#39;hair_flower&#39;: 0.39574217796325684, &#39;charm_(object)&#39;: 0.5394986271858215, &#39;handbag&#39;: 0.37014907598495483, &#39;black_bag&#39;: 0.44918346405029297, &#39;shoulder_bag&#39;: 0.5881174802780151, &#39;symbol-shaped_pupils&#39;: 0.5163478255271912, &#39;blue_cardigan&#39;: 0.28089386224746704, &#39;black_nails&#39;: 0.42480990290641785, &#39;bag_charm&#39;: 0.5010414123535156, &#39;plum_blossoms&#39;: 0.27618563175201416, &#39;flower-shaped_pupils&#39;: 0.5317837595939636}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chars</span>
<span class="go">{&#39;hu_tao_(genshin_impact)&#39;: 0.8859397172927856, &#39;boo_tao_(genshin_impact)&#39;: 0.7348971366882324}</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
<section id="convert-camie-emb-to-prediction">
<h2>convert_camie_emb_to_prediction<a class="headerlink" href="#convert-camie-emb-to-prediction" title="Permalink to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="imgutils.tagging.camie.convert_camie_emb_to_prediction">
<span class="sig-prename descclassname"><span class="pre">imgutils.tagging.camie.</span></span><span class="sig-name descname"><span class="pre">convert_camie_emb_to_prediction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">emb</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'initial'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_refined</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'balanced'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'high_precision'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'high_recall'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'micro_opt'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'macro_opt'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'balanced'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresholds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_underline</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_overlap</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fmt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('rating',</span> <span class="pre">'general',</span> <span class="pre">'character')</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/imgutils/tagging/camie.html#convert_camie_emb_to_prediction"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#imgutils.tagging.camie.convert_camie_emb_to_prediction" title="Permalink to this definition"></a></dt>
<dd><p>Convert stored embeddings back to tag predictions.</p>
<p>Useful for reprocessing existing embeddings with new thresholds or formats.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>emb</strong> (<em>np.ndarray</em>) – Embedding vector(s) from previous inference</p></li>
<li><p><strong>model_name</strong> (<em>str</em>) – Original model variant name</p></li>
<li><p><strong>is_refined</strong> (<em>bool</em>) – Whether embeddings come from refined stage, otherwise from initial stage</p></li>
<li><p><strong>mode</strong> (<em>CamieModeTyping</em>) – Threshold selection strategy</p></li>
<li><p><strong>thresholds</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>float</em><em>, </em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>float</em><em>]</em><em>]</em><em>]</em>) – Custom threshold values</p></li>
<li><p><strong>no_underline</strong> (<em>bool</em>) – Remove underscores from tag names</p></li>
<li><p><strong>drop_overlap</strong> (<em>bool</em>) – Remove overlapping tags in general category</p></li>
<li><p><strong>fmt</strong> (<em>Any</em>) – Output format specification</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Formatted results matching original prediction format</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Any</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Modes for selection:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">balanced</span></code>: Balanced precision/recall</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">high_precision</span></code>: Higher precision thresholds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">high_recall</span></code>: Higher recall thresholds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">micro_opt</span></code>: Micro-optimized thresholds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">macro_opt</span></code>: Macro-optimized thresholds</p></li>
</ul>
</div>
<p>For batch processing (2-dim input), returns a list where each element corresponds
to one embedding’s predictions in the same format as single embedding output.</p>
<dl>
<dt>Example:</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">imgutils.tagging</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_camie_tags</span><span class="p">,</span> <span class="n">convert_camie_emb_to_prediction</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># extract the feature embedding, shape: (W, )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embedding</span> <span class="o">=</span> <span class="n">get_camie_tags</span><span class="p">(</span><span class="s1">&#39;skadi.jpg&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;embedding&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># convert to understandable result</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rating</span><span class="p">,</span> <span class="n">general</span><span class="p">,</span> <span class="n">character</span> <span class="o">=</span> <span class="n">convert_camie_emb_to_prediction</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># these 3 dicts will be the same as that returned by `get_camie_tags(&#39;skadi.jpg&#39;)`</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Batch processing, shape: (B, W)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">get_camie_tags</span><span class="p">(</span><span class="s1">&#39;img1.jpg&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;embedding&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">get_camie_tags</span><span class="p">(</span><span class="s1">&#39;img2.jpg&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;embedding&#39;</span><span class="p">),</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># results will be a list of (rating, general, character) tuples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">convert_camie_emb_to_prediction</span><span class="p">(</span><span class="n">embeddings</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</section>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="wd14.html" class="btn btn-neutral float-left" title="imgutils.tagging.wd14" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="deepdanbooru.html" class="btn btn-neutral float-right" title="imgutils.tagging.deepdanbooru" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, narugo1992, 7eu7d7.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: HEAD
    <span class="fa fa-caret-down"></span>
  </span>
        <div class="rst-other-versions">
                <dl>
                    <dt>Tags</dt>
                        <dd><a href="../../../v0.14.0/index.html">v0.14.0</a></dd>
                        <dd><a href="../../../v0.14.1/index.html">v0.14.1</a></dd>
                        <dd><a href="../../../v0.15.0/api_doc/tagging/camie.html">v0.15.0</a></dd>
                        <dd><a href="../../../v0.16.0/api_doc/tagging/camie.html">v0.16.0</a></dd>
                        <dd><a href="../../../v0.17.0/api_doc/tagging/camie.html">v0.17.0</a></dd>
                        <dd><a href="../../../v0.18.0/api_doc/tagging/camie.html">v0.18.0</a></dd>
                </dl>
                <dl>
                    <dt>Branches</dt>
                        <dd><a href="../../../main/api_doc/tagging/camie.html">main</a></dd>
                        <dd><a href="camie.html">HEAD</a></dd>
                        <dd><a href="../../../dev/attachments/index.html">dev/attachments</a></dd>
                        <dd><a href="../../../dev/pt/index.html">dev/pt</a></dd>
                </dl>
        </div>
    </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>